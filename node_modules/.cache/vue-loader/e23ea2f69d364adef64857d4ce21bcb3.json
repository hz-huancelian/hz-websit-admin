{"remainingRequest":"F:\\webstormProjects\\hz-websit-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\webstormProjects\\hz-websit-admin\\src\\components\\UploadVideo\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\webstormProjects\\hz-websit-admin\\src\\components\\UploadVideo\\index.vue","mtime":1630899514000},{"path":"F:\\webstormProjects\\hz-websit-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjects\\hz-websit-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\webstormProjects\\hz-websit-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjects\\hz-websit-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVXBsb2FkVmlkZW8nLAogIGNvbXBvbmVudHM6IHt9LAogIHByb3BzOiB7CiAgICB2aWRlb3M6IHsKICAgICAgdHlwZTogQXJyYXksCiAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBbXQogICAgICB9CiAgICB9LAogICAgbnVtTGltaXQ6IHsKICAgICAgLy8g5pyA5aSn5YWB6K645LiK5Lyg5Liq5pWwCiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogMQogICAgfSwKICAgIHNpemVMaW1pdDogewogICAgICAvLyDmnIDlpKfljZXmlofku7blpKflsI8KICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiA1MAogICAgfSwKICAgIHZpZGVvQmFzZVVybDogewogICAgICAvLyDlt7LkuIrkvKDlm77niYfmnI3liqHlmajot6/lvoQKICAgICAgdHlwZTogU3RyaW5nLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgdmlkZW9MaXN0OiBbXSwKICAgICAgdmlkZW9TcmM6ICcnLAogICAgICBhY3Rpb25Vcmw6ICdodHRwOi8vOC4xMzYuMTU5LjEzNjo5MDk1L2FwaS9jb21tb24vdmlkZW8vdXBsb2FkJwogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHVwbG9hZFNob3coKSB7CiAgICAgIHJldHVybiB0aGlzLnZpZGVvcy5sZW5ndGggPCB0aGlzLm51bUxpbWl0CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgdmlkZW9zOiB7CiAgICAgIGhhbmRsZXIoKSB7CiAgICAgICAgY29uc3QgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkodGhpcy52aWRlb3MpCiAgICAgICAgaWYgKGlzQXJyYXkgJiYgdGhpcy52aWRlb3MubGVuZ3RoID4gMCkgewogICAgICAgICAgdGhpcy52aWRlb3MubWFwKGl0ZW0gPT4gewogICAgICAgICAgICBpdGVtLmlzU2hvd1BvcHVwID0gZmFsc2UKICAgICAgICAgIH0pCiAgICAgICAgICBkZWJ1Z2dlcgogICAgICAgICAgdGhpcy52aWRlb0xpc3QgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMudmlkZW9zKSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy52aWRlb0xpc3QgPSBbXQogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZSwKICAgICAgaW1tZWRpYXRlOiB0cnVlCiAgICB9CiAgfSwKICBjcmVhdGVkKCkge30sCiAgbWV0aG9kczogewogICAgLy8g5LiK5Lyg5LmL5YmNCiAgICBiZWZvcmVBdmF0YXJVcGxvYWQoZmlsZSkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgIGlmIChbJ3ZpZGVvL21wNCcsICd2aWRlby9vZ2cnLCAndmlkZW8vZmx2JywgJ3ZpZGVvL2F2aScsICd2aWRlby93bXYnLCAndmlkZW8vcm12YicsICd2aWRlby9tb3YnXS5pbmRleE9mKGZpbGUucmF3LnR5cGUpID09IC0xKSB7CiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLXByb21pc2UtcmVqZWN0LWVycm9ycwogICAgICAgICAgcmV0dXJuIHJlamVjdCgn6K+35LiK5Lyg5q2j56Gu55qE6KeG6aKR5qC85byPIScpCiAgICAgICAgfQoKICAgICAgICBpZiAoZmlsZS5zaXplIC8gMTAyNCAvIDEwMjQgPiB0aGlzLnNpemVMaW1pdCkgewogICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZWZlci1wcm9taXNlLXJlamVjdC1lcnJvcnMKICAgICAgICAgIHJldHVybiByZWplY3QoYOinhumikeWkp+Wwj+S4jeiDvei2hei/hyR7dGhpcy5zaXplTGltaXR9TSFgKQogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMudmlkZW9MaXN0Lmxlbmd0aCA9PT0gdGhpcy5udW1MaW1pdCkgewogICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZWZlci1wcm9taXNlLXJlamVjdC1lcnJvcnMKICAgICAgICAgIHJldHVybiByZWplY3QoYOacgOWkmuS4iuS8oCR7dGhpcy5udW1MaW1pdH3kuKrop4bpopFgKQogICAgICAgIH0KCiAgICAgICAgcmVzb2x2ZSgn56ym5ZCI6KGo5Zau6KaP5YmHJykKICAgICAgfSkKICAgIH0sCiAgICAvLyDkuIrkvKDmlLnlj5gKICAgIGFzeW5jIGhhbmRsZUF2YXRhckNoYW5nZShmaWxlLCBmaWxlTGlzdCkgewogICAgICB0cnkgewogICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlQXZhdGFyVXBsb2FkKGZpbGUpCiAgICAgICAgdGhpcy51cGxvYWRJbWdBcGkoZmlsZSkKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZyhKU09OLnN0cmluZ2lmeShlKSkKICAgICAgfQogICAgfSwKICAgIC8vIOS4iuS8oOinhumikeWHhuWkhwogICAgdXBsb2FkSW1nQXBpKGRhdGEpIHsKICAgICAgY29uc29sZS5sb2coZGF0YSwgJ3VwbG9hZCoqJykKICAgICAgY29uc3QgdmlkZW9TcmMgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGRhdGEucmF3KQogICAgICB0aGlzLnZpZGVvTGlzdC5wdXNoKHsKICAgICAgICB2aWRlb0ZpbGU6IGRhdGEsCiAgICAgICAgdXJsOiB2aWRlb1NyYywKICAgICAgICBpc1Nob3dQb3B1cDogZmFsc2UKICAgICAgfSkKICAgICAgdGhpcy4kZW1pdCgnY2hhbmdlJywgdGhpcy52aWRlb0xpc3QpCiAgICB9LAogICAgLy8g6aKE6KeI6KeG6aKRCiAgICBwcmV2aWV3VmlkZW8oZGF0YSkgewogICAgICBpZiAoZGF0YS52aWRlb0xpbmspIHsKICAgICAgICB0aGlzLnZpZGVvU3JjID0gYCR7dGhpcy52aWRlb0Jhc2VVcmx9JHtkYXRhLnZpZGVvTGlua31gCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy52aWRlb1NyYyA9IGRhdGEudXJsCiAgICAgIH0KICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgfSwKICAgIC8vIOWIoOmZpOinhumikQogICAgZGVsZXRlVmlkZW8oaW5kZXgpIHsKICAgICAgdGhpcy4kZW1pdCgnZGVsZXRlJywgaW5kZXgpCiAgICB9LAogICAgaGFuZGxlQ2xvc2UoKSB7CiAgICAgIGNvbnN0IHZpZGVvID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3ZpZGVvJylbMV0KICAgICAgaWYgKCF2aWRlby5wYXVzZWQpIHsKICAgICAgICB2aWRlby5jdXJyZW50VGltZSA9IDAKICAgICAgICB2aWRlby5wYXVzZSgpCiAgICAgIH0KICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2UKICAgIH0KICB9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/UploadVideo","sourcesContent":["<template>\n  <div class=\"upload-box\">\n    <div class=\"avatar-uploader-box\">\n      <!-- 图片预览 -->\n      <div v-for=\"(item, index) in videoList\" :key=\"index\" class=\"video-preview\">\n        <video v-if=\"item.videoLink\" :src=\"`${videoBaseUrl}${item.videoLink}`\" class=\"avatar\" @mouseover.stop=\"item.isShowPopup = true\">\n          您的浏览器不支持视频播放\n        </video>\n        <video v-else :src=\"item.url\" class=\"avatar\" @mouseover.stop=\"item.isShowPopup = true\">\n          您的浏览器不支持视频播放\n        </video>\n        <!-- 显示查看和删除的按钮弹窗 -->\n        <div\n          v-show=\"(item.videoLink || item.url) && item.isShowPopup\"\n          class=\"avatar-uploader-popup\"\n          @mouseleave=\"item.isShowPopup = false\"\n        >\n          <i class=\"el-icon-zoom-in\" @click=\"previewVideo(item)\" />\n          <i class=\"el-icon-delete\" @click=\"deleteVideo(index)\" />\n        </div>\n      </div>\n\n      <!-- 方框样式 -->\n      <el-upload\n        v-show=\"uploadShow\"\n        ref=\"avatarUploader\"\n        :action=\"actionUrl\"\n        :auto-upload=\"false\"\n        :on-change=\"handleAvatarChange\"\n        :show-file-list=\"false\"\n        class=\"avatar-uploader\"\n      >\n        <span\n          v-loading=\"loading\"\n          element-loading-background=\"rgba(0, 0, 0, 0.8)\"\n          element-loading-spinner=\"el-icon-loading\"\n          element-loading-text=\"上传中\"\n          style=\"display:block;\"\n        >\n          <i class=\"el-icon-plus avatar-uploader-icon\" />\n        </span>\n      </el-upload>\n\n      <!-- 上传提示文字样式 -->\n      <div class=\"upload-tip\">\n        <slot />\n      </div>\n    </div>\n\n    <!-- 查看大图 -->\n    <el-dialog :visible.sync=\"dialogVisible\" append-to-body center title=\"视频查看\" :before-close=\"handleClose\">\n      <video ref=\"video\" :src=\"videoSrc\" controls alt width=\"100%\">您的浏览器不支持视频播放</video>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'UploadVideo',\n  components: {},\n  props: {\n    videos: {\n      type: Array,\n      default: function() {\n        return []\n      }\n    },\n    numLimit: {\n      // 最大允许上传个数\n      type: Number,\n      default: 1\n    },\n    sizeLimit: {\n      // 最大单文件大小\n      type: Number,\n      default: 50\n    },\n    videoBaseUrl: {\n      // 已上传图片服务器路径\n      type: String,\n      required: true\n    }\n  },\n  data() {\n    return {\n      loading: false,\n      dialogVisible: false,\n      videoList: [],\n      videoSrc: '',\n      actionUrl: 'http://8.136.159.136:9095/api/common/video/upload'\n    }\n  },\n  computed: {\n    uploadShow() {\n      return this.videos.length < this.numLimit\n    }\n  },\n  watch: {\n    videos: {\n      handler() {\n        const isArray = Array.isArray(this.videos)\n        if (isArray && this.videos.length > 0) {\n          this.videos.map(item => {\n            item.isShowPopup = false\n          })\n          debugger\n          this.videoList = JSON.parse(JSON.stringify(this.videos))\n        } else {\n          this.videoList = []\n        }\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  created() {},\n  methods: {\n    // 上传之前\n    beforeAvatarUpload(file) {\n      return new Promise((resolve, reject) => {\n        if (['video/mp4', 'video/ogg', 'video/flv', 'video/avi', 'video/wmv', 'video/rmvb', 'video/mov'].indexOf(file.raw.type) == -1) {\n          // eslint-disable-next-line prefer-promise-reject-errors\n          return reject('请上传正确的视频格式!')\n        }\n\n        if (file.size / 1024 / 1024 > this.sizeLimit) {\n          // eslint-disable-next-line prefer-promise-reject-errors\n          return reject(`视频大小不能超过${this.sizeLimit}M!`)\n        }\n\n        if (this.videoList.length === this.numLimit) {\n          // eslint-disable-next-line prefer-promise-reject-errors\n          return reject(`最多上传${this.numLimit}个视频`)\n        }\n\n        resolve('符合表單規則')\n      })\n    },\n    // 上传改变\n    async handleAvatarChange(file, fileList) {\n      try {\n        await this.beforeAvatarUpload(file)\n        this.uploadImgApi(file)\n      } catch (e) {\n        this.$message.warning(JSON.stringify(e))\n      }\n    },\n    // 上传视频准备\n    uploadImgApi(data) {\n      console.log(data, 'upload**')\n      const videoSrc = URL.createObjectURL(data.raw)\n      this.videoList.push({\n        videoFile: data,\n        url: videoSrc,\n        isShowPopup: false\n      })\n      this.$emit('change', this.videoList)\n    },\n    // 预览视频\n    previewVideo(data) {\n      if (data.videoLink) {\n        this.videoSrc = `${this.videoBaseUrl}${data.videoLink}`\n      } else {\n        this.videoSrc = data.url\n      }\n      this.dialogVisible = true\n    },\n    // 删除视频\n    deleteVideo(index) {\n      this.$emit('delete', index)\n    },\n    handleClose() {\n      const video = document.getElementsByTagName('video')[1]\n      if (!video.paused) {\n        video.currentTime = 0\n        video.pause()\n      }\n      this.dialogVisible = false\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n$width: 148px;\n$height: 148px;\n\n.upload-box {\n  .avatar-uploader-box {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: wrap;\n    padding-bottom: 20px;\n    min-width: 350px;\n    .avatar-uploader {\n      .el-upload {\n        width: $width;\n        height: $height;\n        border: 1px dashed #d9d9d9;\n        border-radius: 6px;\n        cursor: pointer;\n        position: relative;\n        overflow: hidden;\n        &:hover {\n          border-color: #409eff;\n        }\n        .el-loading-spinner {\n          width: $width;\n          height: $height;\n          position: relative;\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          margin-top: 0;\n          top: 0;\n          .el-loading-text {\n            margin: 0;\n          }\n        }\n      }\n      .avatar-uploader-icon {\n        font-size: 28px;\n        color: #8c939d;\n        width: $width;\n        height: $height;\n        line-height: $height;\n        text-align: center;\n      }\n    }\n    .video-preview {\n      position: relative;\n      padding-right: 20px;\n      .avatar {\n        width: $width;\n        height: $height;\n        display: block;\n        border-radius: 6px;\n      }\n      .avatar-uploader-popup {\n        position: absolute;\n        top: 0;\n        left: 0;\n        z-index: 2;\n        width: $width;\n        height: $height;\n        background: rgba($color: #000000, $alpha: 0.5);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        color: #fff;\n        font-size: 20px;\n        border-radius: 6px;\n        i {\n          width: 30%;\n          text-align: center;\n          padding: 0 5%;\n          font-size: 24px;\n        }\n      }\n    }\n    .upload-tip {\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      font-size: 12px;\n      color: #606266;\n      max-width: 350px;\n      line-height: 20px;\n    }\n  }\n}\n</style>\n"]}]}