{"remainingRequest":"F:\\webstormProjects\\hz-websit-admin\\node_modules\\babel-loader\\lib\\index.js!F:\\webstormProjects\\hz-websit-admin\\node_modules\\eslint-loader\\index.js??ref--13-0!F:\\webstormProjects\\hz-websit-admin\\src\\permission.js","dependencies":[{"path":"F:\\webstormProjects\\hz-websit-admin\\src\\permission.js","mtime":1629789441000},{"path":"F:\\webstormProjects\\hz-websit-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\webstormProjects\\hz-websit-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\webstormProjects\\hz-websit-admin\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCJGOi93ZWJzdG9ybVByb2plY3RzL2h6LXdlYnNpdC1hZG1pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZURlZmF1bHQiKS5kZWZhdWx0OwoKcmVxdWlyZSgicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIik7Cgp2YXIgX29iamVjdFNwcmVhZDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIkY6L3dlYnN0b3JtUHJvamVjdHMvaHotd2Vic2l0LWFkbWluL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL29iamVjdFNwcmVhZDIiKSk7Cgp2YXIgX2FzeW5jVG9HZW5lcmF0b3IyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJGOi93ZWJzdG9ybVByb2plY3RzL2h6LXdlYnNpdC1hZG1pbi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hc3luY1RvR2VuZXJhdG9yIikpOwoKdmFyIF9yb3V0ZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIi4vcm91dGVyIikpOwoKdmFyIF9zdG9yZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZSgiLi9zdG9yZSIpKTsKCnZhciBfZWxlbWVudFVpID0gcmVxdWlyZSgiZWxlbWVudC11aSIpOwoKdmFyIF9ucHJvZ3Jlc3MgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoIm5wcm9ncmVzcyIpKTsKCnJlcXVpcmUoIm5wcm9ncmVzcy9ucHJvZ3Jlc3MuY3NzIik7Cgp2YXIgX2F1dGggPSByZXF1aXJlKCJAL3V0aWxzL2F1dGgiKTsKCnZhciBfZ2V0UGFnZVRpdGxlID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKCJAL3V0aWxzL2dldC1wYWdlLXRpdGxlIikpOwoKLy8gcHJvZ3Jlc3MgYmFyCi8vIHByb2dyZXNzIGJhciBzdHlsZQovLyBnZXQgdG9rZW4gZnJvbSBjb29raWUKX25wcm9ncmVzcy5kZWZhdWx0LmNvbmZpZ3VyZSh7CiAgc2hvd1NwaW5uZXI6IGZhbHNlCn0pOyAvLyBOUHJvZ3Jlc3MgQ29uZmlndXJhdGlvbgoKCnZhciB3aGl0ZUxpc3QgPSBbJy9sb2dpbicsICcvYXV0aC1yZWRpcmVjdCcsICcvcmVnaXN0ZXInXTsgLy8gbm8gcmVkaXJlY3Qgd2hpdGVsaXN0Cgpfcm91dGVyLmRlZmF1bHQuYmVmb3JlRWFjaCggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZiA9ICgwLCBfYXN5bmNUb0dlbmVyYXRvcjIuZGVmYXVsdCkoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHRvLCBmcm9tLCBuZXh0KSB7CiAgICB2YXIgaGFzVG9rZW4sIGhhc1JvbGVzLCBhY2Nlc3NSb3V0ZXM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIF9ucHJvZ3Jlc3MuZGVmYXVsdC5zdGFydCgpOyAvLyBzdGFydCBwcm9ncmVzcyBiYXIKCgogICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9ICgwLCBfZ2V0UGFnZVRpdGxlLmRlZmF1bHQpKHRvLm1ldGEudGl0bGUpOyAvLyBzZXQgcGFnZSB0aXRsZQoKICAgICAgICAgICAgaWYgKCEodG8ucGF0aC5pbmRleE9mKCdyZWdpc3RlcicpID4gLTEpKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDc7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQoKTsKCiAgICAgICAgICAgIF9ucHJvZ3Jlc3MuZGVmYXVsdC5kb25lKCk7CgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzk7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgaGFzVG9rZW4gPSAoMCwgX2F1dGguZ2V0VG9rZW4pKCk7CgogICAgICAgICAgICBpZiAoIWhhc1Rva2VuKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM4OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoISh0by5wYXRoID09PSAnL2xvZ2luJykpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgIHBhdGg6ICcvJwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIF9ucHJvZ3Jlc3MuZGVmYXVsdC5kb25lKCk7CgogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMzY7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIGhhc1JvbGVzID0gX3N0b3JlLmRlZmF1bHQuZ2V0dGVycy5yb2xlcyAmJiBfc3RvcmUuZGVmYXVsdC5nZXR0ZXJzLnJvbGVzLmxlbmd0aCA+IDA7CgogICAgICAgICAgICBpZiAoIWhhc1JvbGVzKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDE5OwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzNjsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDE5OwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMjI7CiAgICAgICAgICAgIHJldHVybiBfc3RvcmUuZGVmYXVsdC5kaXNwYXRjaCgndXNlci9nZXRJbmZvJyk7CgogICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI0OwogICAgICAgICAgICByZXR1cm4gX3N0b3JlLmRlZmF1bHQuZGlzcGF0Y2goJ3Blcm1pc3Npb24vZ2VuZXJhdGVSb3V0ZXMnKTsKCiAgICAgICAgICBjYXNlIDI0OgogICAgICAgICAgICBhY2Nlc3NSb3V0ZXMgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgICAgX3JvdXRlci5kZWZhdWx0LmFkZFJvdXRlcyhhY2Nlc3NSb3V0ZXMpOwoKICAgICAgICAgICAgbmV4dCgoMCwgX29iamVjdFNwcmVhZDIuZGVmYXVsdCkoKDAsIF9vYmplY3RTcHJlYWQyLmRlZmF1bHQpKHt9LCB0byksIHt9LCB7CiAgICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZQogICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzNjsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDI5OwogICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDE5KTsKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDMzOwogICAgICAgICAgICByZXR1cm4gX3N0b3JlLmRlZmF1bHQuZGlzcGF0Y2goJ3VzZXIvcmVzZXRUb2tlbicpOwoKICAgICAgICAgIGNhc2UgMzM6CiAgICAgICAgICAgIF9lbGVtZW50VWkuTm90aWZpY2F0aW9uLmVycm9yKHsKICAgICAgICAgICAgICBtZXNzYWdlOiAn6ZSZ6K+vJywKICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ+ivt+axgueUqOaIt+S/oeaBr+Wksei0pe+8jOivt+mHjeivlScKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBuZXh0KCcvbG9naW4nKTsKCiAgICAgICAgICAgIF9ucHJvZ3Jlc3MuZGVmYXVsdC5kb25lKCk7CgogICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDM5OwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICBpZiAod2hpdGVMaXN0LmluZGV4T2YodG8ucGF0aCkgIT09IC0xKSB7CiAgICAgICAgICAgICAgbmV4dCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG5leHQoJy9sb2dpbicpOwoKICAgICAgICAgICAgICBfbnByb2dyZXNzLmRlZmF1bHQuZG9uZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgY2FzZSAzOToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlLCBudWxsLCBbWzE5LCAyOV1dKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiAoX3gsIF94MiwgX3gzKSB7CiAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKSk7Cgpfcm91dGVyLmRlZmF1bHQuYWZ0ZXJFYWNoKGZ1bmN0aW9uICgpIHsKICAvLyBmaW5pc2ggcHJvZ3Jlc3MgYmFyCiAgX25wcm9ncmVzcy5kZWZhdWx0LmRvbmUoKTsKfSk7"},{"version":3,"sources":["F:/webstormProjects/hz-websit-admin/src/permission.js"],"names":["NProgress","configure","showSpinner","whiteList","router","beforeEach","to","from","next","start","document","title","meta","path","indexOf","done","hasToken","hasRoles","store","getters","roles","length","dispatch","accessRoutes","addRoutes","replace","Notification","error","message","description","afterEach"],"mappings":";;;;;;;;;;AAAA;;AACA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AAHkC;AACD;AACO;AAGxCA,mBAAUC,SAAV,CAAoB;AAAEC,EAAAA,WAAW,EAAE;AAAf,CAApB,E,CAA4C;;;AAE5C,IAAMC,SAAS,GAAG,CAAC,QAAD,EAAW,gBAAX,EAA6B,WAA7B,CAAlB,C,CAA4D;;AAE5DC,gBAAOC,UAAP;AAAA,mFAAkB,iBAAMC,EAAN,EAAUC,IAAV,EAAgBC,IAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAChBR,+BAAUS,KAAV,GADgB,CACE;;;AAClBC,YAAAA,QAAQ,CAACC,KAAT,GAAiB,2BAAaL,EAAE,CAACM,IAAH,CAAQD,KAArB,CAAjB,CAFgB,CAE6B;;AAF7B,kBAIZL,EAAE,CAACO,IAAH,CAAQC,OAAR,CAAgB,UAAhB,IAA8B,CAAC,CAJnB;AAAA;AAAA;AAAA;;AAKdN,YAAAA,IAAI;;AACJR,+BAAUe,IAAV;;AANc;AAAA;;AAAA;AAQRC,YAAAA,QARQ,GAQG,qBARH;;AAAA,iBASVA,QATU;AAAA;AAAA;AAAA;;AAAA,kBAURV,EAAE,CAACO,IAAH,KAAY,QAVJ;AAAA;AAAA;AAAA;;AAWVL,YAAAA,IAAI,CAAC;AAAEK,cAAAA,IAAI,EAAE;AAAR,aAAD,CAAJ;;AACAb,+BAAUe,IAAV;;AAZU;AAAA;;AAAA;AAcJE,YAAAA,QAdI,GAcOC,eAAMC,OAAN,CAAcC,KAAd,IAAuBF,eAAMC,OAAN,CAAcC,KAAd,CAAoBC,MAApB,GAA6B,CAd3D;;AAAA,iBAeNJ,QAfM;AAAA;AAAA;AAAA;;AAgBRT,YAAAA,IAAI;AAhBI;AAAA;;AAAA;AAAA;AAAA;AAAA,mBAmBAU,eAAMI,QAAN,CAAe,cAAf,CAnBA;;AAAA;AAAA;AAAA,mBAqBqBJ,eAAMI,QAAN,CAAe,2BAAf,CArBrB;;AAAA;AAqBAC,YAAAA,YArBA;;AAsBNnB,4BAAOoB,SAAP,CAAiBD,YAAjB;;AACAf,YAAAA,IAAI,6DAAMF,EAAN;AAAUmB,cAAAA,OAAO,EAAE;AAAnB,eAAJ;AAvBM;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,mBAyBAP,eAAMI,QAAN,CAAe,iBAAf,CAzBA;;AAAA;AA0BNI,oCAAaC,KAAb,CAAmB;AACjBC,cAAAA,OAAO,EAAE,IADQ;AAEjBC,cAAAA,WAAW,EAAE;AAFI,aAAnB;;AAIArB,YAAAA,IAAI,CAAC,QAAD,CAAJ;;AACAR,+BAAUe,IAAV;;AA/BM;AAAA;AAAA;;AAAA;AAoCZ,gBAAIZ,SAAS,CAACW,OAAV,CAAkBR,EAAE,CAACO,IAArB,MAA+B,CAAC,CAApC,EAAuC;AACrCL,cAAAA,IAAI;AACL,aAFD,MAEO;AACLA,cAAAA,IAAI,CAAC,QAAD,CAAJ;;AACAR,iCAAUe,IAAV;AACD;;AAzCW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAlB;;AAAA;AAAA;AAAA;AAAA;;AA8CAX,gBAAO0B,SAAP,CAAiB,YAAM;AACrB;AACA9B,qBAAUe,IAAV;AACD,CAHD","sourcesContent":["import router from './router'\nimport store from './store'\nimport { Notification } from 'element-ui'\n\nimport NProgress from 'nprogress' // progress bar\nimport 'nprogress/nprogress.css' // progress bar style\nimport { getToken } from '@/utils/auth' // get token from cookie\nimport getPageTitle from '@/utils/get-page-title'\n\nNProgress.configure({ showSpinner: false }) // NProgress Configuration\n\nconst whiteList = ['/login', '/auth-redirect', '/register'] // no redirect whitelist\n\nrouter.beforeEach(async(to, from, next) => {\n  NProgress.start() // start progress bar\n  document.title = getPageTitle(to.meta.title) // set page title\n\n  if (to.path.indexOf('register') > -1) {\n    next()\n    NProgress.done()\n  } else {\n    const hasToken = getToken()\n    if (hasToken) {\n      if (to.path === '/login') {\n        next({ path: '/' })\n        NProgress.done()\n      } else {\n        const hasRoles = store.getters.roles && store.getters.roles.length > 0\n        if (hasRoles) {\n          next()\n        } else {\n          try {\n            await store.dispatch('user/getInfo')\n            // generate accessible routes map based on roles\n            const accessRoutes = await store.dispatch('permission/generateRoutes')\n            router.addRoutes(accessRoutes)\n            next({ ...to, replace: true })\n          } catch (error) {\n            await store.dispatch('user/resetToken')\n            Notification.error({\n              message: '错误',\n              description: '请求用户信息失败，请重试'\n            })\n            next('/login')\n            NProgress.done()\n          }\n        }\n      }\n    } else {\n      if (whiteList.indexOf(to.path) !== -1) {\n        next()\n      } else {\n        next('/login')\n        NProgress.done()\n      }\n    }\n  }\n})\n\nrouter.afterEach(() => {\n  // finish progress bar\n  NProgress.done()\n})\n"]}]}